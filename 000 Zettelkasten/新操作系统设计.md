---
date: 2024-07-15
style: idea
tags:
  - 操作系统
---

# 正文

在抛开所有历史包袱的情况下，在现代硬件下研究并探索一种新的软件技术体系。

最早的计算机硬件只有实模式，所有程序都可以访问物理地址，那么就需要每个程序负责读写自己所需的空间，这就引发了一个问题——如果某个程序发生了写越界，其造成的后果将会是灾难性的。

操作系统为了解决这个问题，需要将每个程序的空间相互隔离；而为了要跟之前的程序兼容，操作系统需要提供一层抽象，为每个程序提供连续的虚拟地址空间。为了配合这种需求，计算机硬件提供了保护模式，用来完成虚拟地址到物理地址的转换。

以 C 语言使用内存为例，首先 `malloc` 会使用某种策略在连续的虚拟地址上分配一段空间，而当去访问这个地址时，可能会触发缺页中断；然后操作系统会使用某种策略寻找一个可用的物理页，接着去修改页表和 TLB；最后，MMU 将虚拟地址转换为物理地址进行访问。

多层的抽象带来的性能问题是严重的，而更多的时候我们会在这些抽象上运行 VM，然后用自带内存安全的语言。如果从底层开始就是由安全的托管语言构建系统，我们能够删除掉很多的抽象层。托管并不意味着又一层的 overhead，相反，我们会得到一个更简单安全可靠的软件系统。我们不需要复杂的虚拟内存管理，所有应用可以在同一个地址空间上运行，由类型系统和运行时提供隔离，这样做可以以极低的成本来切换上下文和进程间通信。

---

# 引用

- [如何评价 Midori OS](https://www.zhihu.com/question/53232010/answer/135346366)
- [Blogging about Midori](https://joeduffyblog.com/2015/11/03/blogging-about-midori/)
- [一种新的操作系统设计](http://www.yinwang.org/blog-cn/2013/04/14/os-design)
