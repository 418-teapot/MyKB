---
date: 2024-09-11
style: idea
tags:
  - 编程方法
---

# 正文

只有当其他手段都失效时，调试才会是最后的手段。我们要做的首先是避免出现 bug。

## 防御性编程的防线

### 第一道防线是使 bug 不可能出现

- 选择使用保证内存安全（除非通过对该内存区域的有效引用，否则无法访问内存的任何部分）和类型安全（任何值都不能以其类型不一致的方式使用）的语言；
- 自动数组边界检查可以避免缓冲区溢出错误；
- 不可变对象可以放心地进行传递和共享。

### 第二道防线是不产生 bug

- 在编写代码之前要仔细思考；
- 将程序拆分为容易理解的模块，使用良定义的抽象数据类型和接口，为所有模块撰写清楚的文档；
- 使用自动代码分析工具，使用形式化验证方法；
- 使用代码审查和结对编程等社会学方法。

### 第三道防线是使 bug 更容易被发现

- 错误出现得越早，诊断和修复越容易。如果在错误点之后继续进行计算，那么可能会掩盖故障真正发生的位置；
- 断言：可以及早捕获错误，防止污染进一步的计算。

### 第四道防线是广泛的测试

- 在开发代码的同时编写相对较小的单元测试尤其重要。这些测试的运行应该是自动化的，这样如果破坏了代码，就能够尽早地发现。

## 如何调试

### 将 bug 提炼成一个小的测试用例

- 调试是一项艰苦的工作，但是测试用例越小，就越有可能发现问题，花在这种提炼的时间可以节省更多的调试时间。

### 找到原因

- 提出关于错误发生原因的假设；
- 设计实验来肯定或否定该假设；
- 运行实验并记录结果；
- 根据所学知识，重新阐述假设；
- 继续，直到能够理性、科学地确定错误的原因。

### 修复 bug

- 这个修复可能是对拼写错误的简单修复；也可能反应了整个设计的缺陷，需要考虑是否对代码进行重构。

### 回归测试

- 将之前的错误用例放入到单元测试中，这样每当进行更改时都可以自动防范相同的错误；重复运行从以前的错误中提取的测试是回归测试的一部分。

---

# 引用

- [Debugging, 6.005 Elements of Software Construction](https://stellar.mit.edu/S/course/6/fa08/6.005/courseMaterial/topics/topic3/lectureNotes/Debugging/Debugging.pdf)
- [Debugging in Ocaml](https://cs3110.github.io/textbook/chapters/basics/debugging.html)
